{% extends "base.html" %} 
{% block title %}{{ translations['title'][current_lang] }}{% endblock %} 
{% block content %}
<div class="container">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <!-- TÍTULO PRINCIPAL -->
      <h1 class="text-center mb-5" style="font-size: 3rem; font-weight: 700;">
        <i class="bi bi-newspaper" style="color: #159696;"></i>
        {{ translations['title'][current_lang] }}
      </h1>

      <!-- FORMULARIO DE BÚSQUEDA MEJORADO -->
      <div class="search-form mb-5">
        <form method="POST" class="row g-3">
          <div class="col-md-9">
            <div class="position-relative">
              <i class="bi bi-search position-absolute" 
                 style="left: 20px; top: 50%; transform: translateY(-50%); color: #159696; font-size: 1.2rem;"></i>
              <input
                type="text"
                name="keyword"
                placeholder="{{ translations['search_placeholder'][current_lang] }}"
                value="{{ keyword }}"
                class="form-control"
                style="padding-left: 50px; font-size: 1.1rem;"
                required
              />
            </div>
            <input type="hidden" name="lang" value="{{ current_lang }}" />
          </div>
          <div class="col-md-3">
            <button type="submit" class="btn btn-primary w-100" style="height: 100%;">
              <i class="bi bi-search"></i> 
              {{ translations['search_button'][current_lang] }}
            </button>
          </div>
        </form>
      </div>

      {% if keyword %}
      
      <!-- HEADER DE RESULTADOS -->
      <div class="alert alert-info mb-4" style="border-left: 5px solid #159696; background: rgba(21, 150, 150, 0.1);">
        <i class="bi bi-info-circle"></i>
        <strong>{{ translations['results_for'][current_lang] }}:</strong> "{{ keyword }}"
      </div>

      <!-- RESULTADOS LOCALES -->
      {% if local_results %}
      <div class="result-section mb-5">
        <h3 class="section-title">
          <i class="bi bi-house-door-fill"></i> 
          {{ translations['local_results'][current_lang] }}
          <span class="badge bg-primary ms-2">{{ local_results|length }}</span>
        </h3>
        
        <!-- GRID DE TARJETAS -->
        <div class="row row-cols-1 row-cols-md-2 g-4">
          {% for item in local_results %}
          <div class="col">
            <div class="card h-100 position-relative">
              <!-- BADGE DE VERIFICACIÓN EN ESQUINA -->
              <div class="position-absolute top-0 end-0 m-3" style="z-index: 10;">
                <span class="badge {% if item.verificacion != translations['not_verified'][current_lang] %}bg-success{% else %}bg-danger{% endif %}">
                  <i class="bi bi-{% if item.verificacion != translations['not_verified'][current_lang] %}shield-check{% else %}shield-x{% endif %}"></i>
                </span>
              </div>

              <div class="card-body">
                <!-- TÍTULO -->
                <h4 class="card-title mb-3" style="line-height: 1.4;">
                  <a href="{{ url_for('detalle_noticia', uri=item.uri, lang=current_lang, keyword=keyword) }}"
                     style="font-weight: 600; color: var(--link-color);">
                    {{ item.titulo }}
                  </a>
                  {% if item.original_lang and item.original_lang != current_lang %}
                  <span class="badge bg-info ms-2" style="font-size: 0.7rem; vertical-align: middle;">
                    <i class="bi bi-translate"></i> {{ translations['translated_from'][current_lang] }} {{ item.original_lang }}
                  </span>
                  {% endif %}
                </h4>

                <!-- METADATA CON ICONOS -->
                <div class="card-text news-meta mb-3">
                  <div class="d-flex flex-wrap gap-3">
                    <div class="d-flex align-items-center">
                      <i class="bi bi-calendar3 me-2" style="color: #159696;"></i>
                      <small>{{ item.fecha }}</small>
                    </div>
                    <div class="d-flex align-items-center">
                      <i class="bi bi-tag-fill me-2" style="color: #159696;"></i>
                      <small>{{ item.tematica }}</small>
                    </div>
                    <div class="d-flex align-items-center">
                      <i class="bi bi-person-circle me-2" style="color: #159696;"></i>
                      <small>{{ item.autor }}</small>
                    </div>
                  </div>
                </div>

                <!-- ESTADO DE VERIFICACIÓN -->
                <div class="mb-3">
                  <div class="verification {% if item.verificacion != translations['not_verified'][current_lang] %}verified{% else %}unverified{% endif %}"
                       style="display: inline-block; padding: 8px 16px; border-radius: 20px; font-size: 0.9rem;">
                    <i class="bi bi-{% if item.verificacion != translations['not_verified'][current_lang] %}check-circle-fill{% else %}exclamation-circle-fill{% endif %}"></i>
                    {{ item.verificacion }}
                  </div>
                </div>
              </div>

              <!-- FOOTER CON BOTONES -->
              <div class="card-footer bg-transparent border-0 p-3">
                <div class="d-flex justify-content-between gap-2">
                  <a href="{{ url_for('detalle_noticia', uri=item.uri, lang=current_lang, keyword=keyword) }}"
                     class="btn btn-outline-secondary btn-sm flex-grow-1">
                    <i class="bi bi-info-circle"></i> 
                    {{ translations['view_details'][current_lang] }}
                  </a>
                  {% if item.enlaceDBpedia %}
                  <a href="{{ item.enlaceDBpedia }}" 
                     target="_blank" 
                     class="btn btn-outline-primary btn-sm">
                    <i class="bi bi-box-arrow-up-right"></i>
                  </a>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <!-- RESULTADOS DE DBPEDIA -->
      <div class="result-section">
        <h3 class="section-title">
          <i class="bi bi-globe2"></i> 
          {{ translations['dbpedia_results'][current_lang] }}
          {% if dbpedia_results %}
          <span class="badge bg-success ms-2">{{ dbpedia_results|length }}</span>
          {% endif %}
        </h3>
        
        {% if dbpedia_results %}
        <div class="row row-cols-1 row-cols-md-2 g-4">
          {% for item in dbpedia_results %}
          <div class="col">
            <div class="card h-100" style="border: 2px solid #159696;">
              {% if item.thumbnail %}
              <div style="height: 200px; overflow: hidden; background: linear-gradient(135deg, #159696 0%, #1bb3b3 100%);">
                <img src="{{ item.thumbnail.value }}" 
                     class="card-img-top w-100 h-100" 
                     style="object-fit: cover; opacity: 0.9;"
                     alt="Thumbnail">
              </div>
              {% endif %}
              
              <div class="card-body">
                <h4 class="card-title mb-3">
                  <a href="{{ item.resource.value }}" 
                     target="_blank"
                     style="font-weight: 600; color: #159696;">
                    <i class="bi bi-link-45deg"></i>
                    {{ item.label.value }}
                  </a>
                </h4>
                
                <p class="card-text" style="line-height: 1.6;">
                  {{ item.abstract.value[:200] }}{% if item.abstract.value|length > 200 %}...{% endif %}
                </p>
                
                <div class="card-text text-muted-custom mt-3">
                  {% if item.date %}
                  <span class="me-3">
                    <i class="bi bi-calendar-event"></i> {{ item.date.value }}
                  </span>
                  {% endif %}
                  {% if item.author %}
                  <span>
                    <i class="bi bi-person-badge"></i> {{ item.author.value }}
                  </span>
                  {% endif %}
                </div>
              </div>
              
              <div class="card-footer bg-transparent border-0 p-3">
                <a href="{{ item.resource.value }}" 
                   target="_blank" 
                   class="btn btn-primary w-100">
                  <i class="bi bi-box-arrow-up-right"></i> 
                  {{ translations['view_on_dbpedia'][current_lang] }}
                </a>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <div class="alert alert-warning" style="border-radius: 12px; border-left: 5px solid #ffc107;">
          <i class="bi bi-exclamation-triangle-fill"></i> 
          {{ translations['no_dbpedida_results'][current_lang] }}
        </div>
        {% endif %}
      </div>

      {% else %}
      <!-- MENSAJE INICIAL CUANDO NO HAY BÚSQUEDA -->
      <div class="text-center mt-5 mb-5" style="opacity: 0.7;">
        <i class="bi bi-search" style="font-size: 5rem; color: #159696;"></i>
        <p class="mt-4" style="font-size: 1.2rem;">
          Ingresa una palabra clave para comenzar tu búsqueda
        </p>
      </div>
      {% endif %}
    </div>
  </div>
</div>

<!-- BOTÓN DE SCROLL TO TOP -->
<button id="scrollTopBtn" 
        style="position: fixed; bottom: 30px; right: 30px; z-index: 1000; 
               display: none; width: 50px; height: 50px; border-radius: 50%; 
               background: linear-gradient(135deg, #159696 0%, #1bb3b3 100%); 
               border: none; color: white; box-shadow: 0 4px 12px rgba(21, 150, 150, 0.4);
               cursor: pointer; transition: all 0.3s ease;">
  <i class="bi bi-arrow-up" style="font-size: 1.5rem;"></i>
</button>

{% endblock %}

{% block scripts %}
<script>
// Scroll to top functionality
const scrollTopBtn = document.getElementById('scrollTopBtn');

window.addEventListener('scroll', () => {
  if (window.pageYOffset > 300) {
    scrollTopBtn.style.display = 'block';
  } else {
    scrollTopBtn.style.display = 'none';
  }
});

scrollTopBtn.addEventListener('click', () => {
  window.scrollTo({
    top: 0,
    behavior: 'smooth'
  });
});

scrollTopBtn.addEventListener('mouseenter', function() {
  this.style.transform = 'scale(1.1)';
});

scrollTopBtn.addEventListener('mouseleave', function() {
  this.style.transform = 'scale(1)';
});
</script>
{% endblock %}